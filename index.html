<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="css/style.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <table class="table">
        <tr>
            <td id="header1"><p>Yazılım Mühendisliği</p></td>
            <td id="header2"><p>Bilgisayar Mühendisliği</p></td>
            <td id="header3"><p>Elektrik-Elektronik Mühendisliği</p></td>
        </tr>
        <th id="box1" ondrop="drop(event)" ondragover="dropAble(event)"></th>
        <th id="box2" ondrop="drop(event)" ondragover="dropAble(event)"></th>
        <th id="box3" ondrop="drop(event)" ondragover="dropAble(event)"></th>
    </table>

    <form action="/addCard" method="POST">
        <input type="text" class="textInput" name="name" placeholder="İsim" required>
        <br>
        <input type="text" class="textInput" name="surname" placeholder="Soyisim" required>
        <br>
        <input type="text" class="textInput" name="email" placeholder="Email" required>
        <br>
        <input type="radio" id="radio1" class="radiobutton"  name="bolumid" value="1" required checked>
        <label for="radio1">Yazılım Müh.</label>
        <br>
        <input type="radio" id="radio2" class="radiobutton"  name="bolumid"  value="2">
        <label for="radio2">Bilgisayar Müh.</label>
        <br>
        <input type="radio" id="radio3" class="radiobutton"  name="bolumid"  value="3">
        <label for="radio3">Elektrik-Elektronik Müh.</label>
        <br>
        <input type="submit" value="+" class="addButton" >
    </form>

    
    

    <script>
        function dropAble(ev) {
            ev.preventDefault();
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
        }

        function drop(ev) {
            let targetbox = ev.target;
            ev.preventDefault();
            var data = ev.dataTransfer.getData("text");
            if(targetbox.id == "box1" || targetbox.id == "box2" || targetbox.id =="box3")
            {
                targetbox.appendChild(document.getElementById(data));
                console.log(targetbox.id);
                console.log(data);
                let bolumid;
                switch (targetbox.id) {
                    case "box1":
                        bolumid = 1;
                        break;
                    case "box2":
                        bolumid = 2;
                        break;
                    case "box3":
                        bolumid = 3;
                        break;
                    default:
                        bolumid = null;
                }

                if (bolumid !== null) {
                    postData(bolumid, data);
            }
            }
            
        }

        async function postData(bolumid, data) {
            try {
                const response = await fetch('/submit-data', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ bolumid: bolumid, data: data })
                });
                const result = await response.text();
                console.log('Success:', result);
            } catch (error) {
                console.error('Error:', error);
            }
        }
        
        fetch('/data')
            .then(response => response.json())
            .then(data => {
                const boxes = ["box1", "box2", "box3"];
                data.forEach((person, index) => {
                    const card = document.createElement('div');
                    card.className = 'drag';
                    card.draggable = true;
                    card.id = "drag"+(index + 1);
                    card.setAttribute("ondragstart", "drag(event)");
                    card.innerHTML = `
                        <p>
                            <span>Ad:</span>
                            <span>${person.name}</span>
                        </p>
                        <p>
                            <span>Soyad:</span>
                            <span>${person.surname}</span>
                        </p>
                        <p>
                            <span>Email:</span>
                            <span>${person.email}</span>
                        </p>
                    `;
                    switch (person.bolumid) {
                        case 1:
                            document.getElementById("box1").appendChild(card);
                            break;
                        case 2:
                            document.getElementById("box2").appendChild(card);
                            break;
                        case 3:
                            document.getElementById("box3").appendChild(card);
                            break;
                    }
                });
            })
            .catch(error => console.error('Error:', error));

        

        
    </script>
</body>
</html>
